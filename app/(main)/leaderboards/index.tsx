import React,{useState,useEffect}from'react';import{View,Text,StyleSheet,ScrollView,TouchableOpacity,Animated}from'react-native';import{COLORS}from'@/theme/palette';import{typography}from'@/theme/typography';import{useTheme}from'@/theme/useTheme';import{useLeaderboardStore,LeaderboardEntry,LeaderboardType}from'@/store/leaderboardStore';import{useAuthStore}from'@/store/authStore';import ProgressBar from '@/components/ProgressBar';const LeaderboardScreen=()=>{const{colors}=useTheme();const leaderboardStore=useLeaderboardStore();const authStore=useAuthStore();const[activeTab,setActiveTab]=useState<LeaderboardType>('weekly');const[leaderboard,setLeaderboard]=useState<LeaderboardEntry[]>([]);const[currentUser,setCurrentUser]=useState<LeaderboardEntry|null>(null);const userId=authStore.user?.id||'current-user';useEffect(()=>{loadLeaderboard(activeTab);},[activeTab,userId]);const loadLeaderboard=async(type:LeaderboardType)=>{const entries=leaderboardStore.getLeaderboard(type);setLeaderboard(entries);const userRank=leaderboardStore.getUserRank(userId,type);if(userRank){const userEntry=entries.find(e=>e.userId===userId)||null;setCurrentUser(userEntry);}};const handleShareRank=()=>{const rank=currentUser?.rank;if(rank){alert(`I'm #${rank} on LearnSmart's ${activeTab} leaderboard!`);}};return(<View style={[styles.container,{backgroundColor:colors.background}]}><View style={styles.header}><Text style={[styles.title,{color:colors.text}]}>Leaderboards</Text><Text style={[styles.subtitle,{color:colors.secondaryText}]}>Compete with learners worldwide</Text></View><View style={styles.tabs}>{(['weekly','monthly','allTime'] as const).map(tab=>(<TouchableOpacity key={tab} style={[styles.tab,activeTab===tab&&{backgroundColor:colors.primary}]} onPress={()=>setActiveTab(tab)}><Text style={[styles.tabText,{color:activeTab===tab?colors.white:colors.secondaryText}]}>{tab==='weekly'?'This Week':tab==='monthly'?'This Month':'All Time'}</Text></TouchableOpacity>))}</View><View style={styles.podium}>
{leaderboard.slice(0,3).map((entry,index)=>{const colorsMap=['#FFD700','#C0C0C0','#CD7F32'];const positions=['1st','2nd','3rd'];return(<View key={entry.userId} style={styles.podiumItem}><View style={[styles.podiumRank,{backgroundColor:colorsMap[index]}]}><Text style={styles.podiumRankText}>{positions[index]}</Text></View><View style={[styles.avatar,{backgroundColor:colors.border}]}><Text style={styles.avatarText}>{entry.username[0]}</Text></View><Text style={[styles.username,{color:colors.text}]}>{entry.username}</Text><Text style={[styles.points,{color:colors.primary}]}>{entry.points} pts</Text></View>);})}
</View>{currentUser&&(<TouchableOpacity style={[styles.userRank,{backgroundColor:colors.card}]} onPress={handleShareRank}><Text style={[styles.yourRankTitle,{color:colors.text}]}>Your Rank</Text><Text style={[styles.rankInfo,{color:colors.secondaryText}]}>#{currentUser.rank} of {leaderboard.length}</Text><Text style={[styles.pointsInfo,{color:colors.primary}]}>{currentUser.points} points</Text><ProgressBar progress={currentUser.rank===1?100:(leaderboard[0].points-currentUser.points)/leaderboard[0].points*100} color={colors.primary} backgroundColor={colors.border}/><Text style={[styles.shareText,{color:colors.accent}]}>Share your rank</Text></TouchableOpacity>)}
<ScrollView style={styles.leaderboardList}><Text style={[styles.leaderboardTitle,{color:colors.text}]}>Full Leaderboard</Text>{leaderboard.map((entry)=>{const isCurrentUser=entry.userId===userId;return(<View key={`${entry.userId}-${activeTab}`} style={[styles.listItem,isCurrentUser&&{backgroundColor:colors.primary+'20'}]}><Text style={[styles.listRank,{color:colors.secondaryText}]}>{entry.rank}</Text><View style={[styles.listAvatar,{backgroundColor:colors.border}]}><Text style={styles.listAvatarText}>{entry.username[0]}</Text></View><View style={styles.listInfo}><Text style={[styles.listUsername,{color:colors.text}]}>{entry.username}{isCurrentUser&&<Text style={{color:colors.primary}}> (You)</Text>}</Text></View><Text style={[styles.listPoints,{color:colors.primary}]}>{entry.points}</Text></View>);})}</ScrollView></View>)};const styles=StyleSheet.create({container:{flex:1},header:{padding:24,paddingTop:48,borderBottomWidth:1,borderBottomColor:'rgba(0,0,0,0.1)'},title:{...typography.heading,fontSize:28,fontWeight:'bold',marginBottom:8},subtitle:{...typography.body,fontSize:16},tabs:{flexDirection:'row',padding:16,gap:8},tab:{flex:1,paddingHorizontal:16,paddingVertical:8,borderRadius:20,borderWidth:1,borderColor:'rgba(0,0,0,0.1)'},tabText:{...typography.body,fontSize:14,textAlign:'center'},podium:{flexDirection:'row',justifyContent:'space-around',alignItems:'flex-end',padding:24},podiumItem:{alignItems:'center',flex:1},podiumRank:{width:48,height:48,borderRadius:24,justifyContent:'center',alignItems:'center',marginBottom:12},podiumRankText:{...typography.heading,fontSize:18,fontWeight:'bold',color:'white'},avatar:{width:60,height:60,borderRadius:30,justifyContent:'center',alignItems:'center',marginBottom:8},avatarText:{fontSize:24,fontWeight:'bold'},username:{...typography.bodyBold,fontSize:16,marginBottom:4,textAlign:'center'},points:{...typography.body,fontSize:14,textAlign:'center'},userRank:{margin:16,padding:16,borderRadius:12,borderWidth:1,borderColor:'rgba(0,0,0,0.1)'},yourRankTitle:{...typography.bodyBold,fontSize:16,marginBottom:12},rankInfo:{...typography.body,fontSize:14,marginBottom:4},pointsInfo:{...typography.body,fontSize:14,marginBottom:12},shareText:{...typography.caption,fontSize:12,textAlign:'center',marginTop:8},leaderboardList:{flex:1,paddingHorizontal:16},leaderboardTitle:{...typography.bodyBold,fontSize:16,marginBottom:12},listItem:{flexDirection:'row',alignItems:'center',padding:12,borderRadius:8,borderWidth:1,borderColor:'rgba(0,0,0,0.1)',marginBottom:8},listRank:{...typography.caption,fontSize:12,width:24},listAvatar:{width:36,height:36,borderRadius:18,justifyContent:'center',alignItems:'center',marginHorizontal:12},listAvatarText:{fontSize:16,fontWeight:'bold'},listInfo:{flex:1},listUsername:{...typography.body,fontSize:14},listPoints:{...typography.body,fontSize:14,fontWeight:'600'}
});export default LeaderboardScreen;